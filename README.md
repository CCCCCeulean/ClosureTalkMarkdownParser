# 欢迎使用 Markdown-ClosureTalkJson-Parser

本工具用于快速的 ObsidianMarkdown 转化为 [Closure Talk](https://closuretalk.github.io/) 可读取的 Json 文件。
推荐在 Obsidian 环境下使用本工具。
```
别在仓库里直接玩这个！
~~当然写完了放进来是可以的~~
建议自己写个.gitignore放屏蔽文件夹里去
```

正则表达式编写得较为简单，不要对其施加过多压力……
以下这些范例在直接复制交予右侧窗口直接读入应该没啥压力……吧？
推荐你读完后使用 main.exe 执行快速构建，然后读取 `demo.md` 后输出看看。 

# 引入

若从文件导入，务必在整个对话开始前书写：
```
> [!info] ClosureTalk
```

即:
> [!info] ClosureTalk

这将作为判断是否是合法文件的起始点，且之前的内容将被忽略。

# 角色声明语法：

- 自定义角色的主要代号 | 角色将来会默认显示的名称
	- 想要简便书写的其他代称 1
	- 想要简便书写的其他代称 2
	- 自定义角色的主要代号也将作为代称使用
- 如果没有指定名称，代号将默认作为名称使用
	- 自定义角色的头像默认使用同名的图片
    - `![[或者直接使用 Obsidian 风格的本地图片引入以给出更高优先级的映射，名字任意]]` 
    - `!(foo)[url]` 也支持线上图床，但不确保效果是否合适
- ==强调以使用 ClosureTalk 的线上角色== | ==你必须助记 ClosureTalk 的线上角色所用的皮肤名==
	- 线上角色必须再次书写简便书写代称！

不使用列表的句子将不会被读取。
以下内容请直接放入 Parser 右上进行读取:

- ==ba-Shiroko== | ==Shiroko==
	- Shiroko
	- 白子
- ==ba-Toki== | ==CH0187==
	- 飞马鸟时
	- 这两位都会使用 ClosureTalk 默认风格的头像+背景模式。
	- 要小心 id 和 Img，建议先下一份 json 做完自己的常用表
	- 也要小心 ==EasyTyping== 等任何自动格式!!!
- ==ba-Toki== | ==NP0079==
	- absToki
	- 阿比舒
- toki | 季
	- 请读取 pictures 里的 toki.jpeg 
	- 不然她就会以黑色头像出现在 ClosureTalk 里
- 时
	- ![[toki.jpeg|100]]
	- 假如你已经读取了 pictures，那么 "时" 也会使用这个摆烂 toki 的图片
- 季
	- ![](https://i1.hdslb.com/bfs/archive/e3d8fb938413d6bd60466dfde348baf22f0289a6.jpg@672w_378h_1c_!web-search-common-cover.avif) 
	- 季将会使用 [【中文字幕/角色PV】飞鸟马 时_手机游戏热门视频 (bilibili.com)](https://www.bilibili.com/video/BV1pj411V7kw/) 的标题图，不知道能用多久
- Himari 
	- ![[himari.gif|100]]
	- ClosureTalk 甚至支持 gif 令人感叹
	- *但你该怎么让别人看到呢？ 另外，现在这句话不会被 CharaParser 捕获*

---

# 正文语法：
请读取以下内容:

# 你可以书写章节符，它将默认产生一个旁白与分隔符便于你切割图片
- Shiroko 
	- 嗯
	- 老师说的是对的
- 飞马鸟时
	- 阿比舒。
- 阿比舒
	- 接下来会出现 ~不同级的章节符效果是一样的~ 的旁白。
## 不同级的章节符效果是一样的
- Shiroko
	- 任意的左侧角色
	- 使用缩进表格表述说话
	- *使用斜体表述旁白*
	- ==使用提示标记以进入当前角色的羁绊剧情==
- ==在左侧有两个等于号表述右侧角色==
	- 说点啥吧
	- ==这样将进入老师的羁绊剧情==
	1. 依照顺序输入数字和点以进入选择
	2. 这样将接续选择
	3. 继续增长选择
	1. 新的选择
- 时 | 完美潇洒的求职女仆
	- 这样将说出一句话
- 季将会使用 [【中文字幕/角色PV】飞鸟马 时_手机游戏热门视频 (bilibili.com)](https://www.bilibili.com/video/BV1pj411V7kw/) 的标题图，不知道能用多久
	- pyon, pyon
- 季
	- 再度使用了不缩进的表格而出现了头像的完美女仆。
	- ![[toki.jpeg|100]]
- ==
	- ![[toki.jpeg|100]]
	- 真厉害呢
	  而使用缩进不使用无序列表将会使得两句话合在一个对话框内
	  可以在任何编辑器使用 Shift+Enter 快捷打出。
---
- 白子
	- 可以使用分隔符分开上下文章
	- ![[shiroko.jpg|100]]
	- 使用这种 Obsidian 式的图片以插入图片。
	- 也可以使用线上图床，会尝试下载图片。
	- 假如 PictureParser 没有同名的图片，片将会以 1 个黑色像素点的形式给出。
- ==假如是老师声明的图片，则图片会从右侧出现。
	- ![[shiroko.jpg]]
- Himari
	- [[shiroko.jpg]]
	- 也支持这种不给出感叹号的图片
	- ![](https://i1.hdslb.com/bfs/archive/e3d8fb938413d6bd60466dfde348baf22f0289a6.jpg@672w_378h_1c_!web-search-common-cover.avif)
	- 对话不支持 gif，不支持 gif!!!!!!

# 使用
## 日志
日志提供了分析时的信息。
## 识别到的角色组
```
线上角色名 ~ 线上角色皮肤
	| 使用的代称
	| 假如线上角色没有代称，会提醒 [警告: 没有任何指向该角色的词语!]
自建角色名 | 正式名称: 正式名称 | 是否有头像
	| 使用的代称
```

## 识别到的图片
将会按照本地图片、线上图片下载链接的顺序给出当前所有识别到的图片。

## 临时 CustomCharaSet 
可以在这里临时载入复制来的角色声明语句。
填写完毕后需要传入上文。

## 临时 MarkdownMomotalk
可以在这里临时载入复制来的正文。
填写完毕后需要传入上文。

## 导出 ClosureTalk.Json
右下只提供 json 输出提醒。
快速构建将会读取当前工作环境的 pictures 文件夹和 `_CustomCharaSet.md ` 文件。 `_CustomCharaSet.md ` 必须有 1 个合法的头部声明。
加了未压缩 base 64 图片的文档非常巨大，谨慎打开！

# 其他

- 在熟练使用后，您应该使用其他编辑器完成编辑后打开它进行转换。
- 推荐你使用 Obsidian 编写文本，并且使用文件里~~还没挑好~~附带的 .css 与 方正兰亭圆简体中 字体在深色模式下书写。
- 源代码主入口在 `main.py` 里，不是很懂 tkinter ，可能依赖 `requests` ，自行使用 pip 下载吧